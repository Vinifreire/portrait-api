# frozen_string_literal: true
require 'rails_helper'

describe TickerCalculateService do
  subject(:calculate) { described_class.call(results) }

  let(:results) do 
    [
      {"v"=>112117471.0, "vw"=>125.725, "o"=>130.28, "c"=>125.07, "h"=>130.9, "l"=>124.17, "t"=>1672722000000, "n"=>1021065},
      {"v"=>89100633.0, "vw"=>126.6464, "o"=>126.89, "c"=>126.36, "h"=>128.6557, "l"=>125.08, "t"=>1672808400000, "n"=>770042},
      {"v"=>80716808.0, "vw"=>126.0883, "o"=>127.13, "c"=>125.02, "h"=>127.77, "l"=>124.76, "t"=>1672894800000, "n"=>665458},
      {"v"=>87754715.0, "vw"=>128.1982, "o"=>126.01, "c"=>129.62, "h"=>130.29, "l"=>124.89, "t"=>1672981200000, "n"=>711520},
      {"v"=>70790813.0, "vw"=>131.6292, "o"=>130.465, "c"=>130.15, "h"=>133.41, "l"=>129.89, "t"=>1673240400000, "n"=>645365},
      {"v"=>63896155.0, "vw"=>129.822, "o"=>130.26, "c"=>130.73, "h"=>131.2636, "l"=>128.12, "t"=>1673326800000, "n"=>554940},
      {"v"=>69458949.0, "vw"=>132.3081, "o"=>131.25, "c"=>133.49, "h"=>133.51, "l"=>130.46, "t"=>1673413200000, "n"=>561278},
      {"v"=>71379648.0, "vw"=>133.171, "o"=>133.88, "c"=>133.41, "h"=>134.26, "l"=>131.44, "t"=>1673499600000, "n"=>635331},
      {"v"=>57809719.0, "vw"=>133.6773, "o"=>132.03, "c"=>134.76, "h"=>134.92, "l"=>131.66, "t"=>1673586000000, "n"=>537385},
      {"v"=>63612627.0, "vw"=>135.7587, "o"=>134.83, "c"=>135.94, "h"=>137.29, "l"=>134.13, "t"=>1673931600000, "n"=>595831},
      {"v"=>69672800.0, "vw"=>136.3316, "o"=>136.815, "c"=>135.21, "h"=>138.61, "l"=>135.03, "t"=>1674018000000, "n"=>578304},
      {"v"=>58280413.0, "vw"=>134.9653, "o"=>134.08, "c"=>135.27, "h"=>136.25, "l"=>133.77, "t"=>1674104400000, "n"=>491674},
      {"v"=>80200655.0, "vw"=>136.3762, "o"=>135.28, "c"=>137.87, "h"=>138.02, "l"=>134.22, "t"=>1674190800000, "n"=>552230},
      {"v"=>81760313.0, "vw"=>141.2116, "o"=>138.12, "c"=>141.11, "h"=>143.315, "l"=>137.9, "t"=>1674450000000, "n"=>719288}
    ]
  end

  context 'when calls calculate' do
    let(:expected_result) { {:price=>[143.315, 124.17, 133.7425], :volume=>[112117471.0, 57809719.0, 132.27920714285716]}.to_json }
    
    it { is_expected.to eq expected_result }
  end
end
